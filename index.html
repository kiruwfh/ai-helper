<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Study Helper üìö</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 24px;
      padding: 40px;
      max-width: 650px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      text-align: center;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 42px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 35px;
      font-size: 16px;
      line-height: 1.5;
    }

    #startBtn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 20px 50px;
      font-size: 24px;
      font-weight: bold;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
      transition: all 0.3s ease;
      display: inline-block;
    }

    #startBtn:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 12px 32px rgba(102, 126, 234, 0.6);
    }

    #startBtn:active:not(:disabled) {
      transform: translateY(-1px);
    }

    #startBtn:disabled {
      background: linear-gradient(135deg, #999, #777);
      cursor: not-allowed;
      transform: none;
      opacity: 0.7;
    }

    #result {
      margin-top: 40px;
      padding: 30px;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 16px;
      display: none;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .answer {
      font-size: 96px;
      font-weight: bold;
      color: #667eea;
      margin: 20px 0;
      text-shadow: 3px 3px 6px rgba(0,0,0,0.1);
      letter-spacing: 12px;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .loading {
      display: inline-block;
      width: 60px;
      height: 60px;
      border: 6px solid #f3f3f3;
      border-top: 6px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 20px 0;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .instructions {
      background: #e7f3ff;
      border: 2px solid #2196F3;
      border-radius: 12px;
      padding: 25px;
      margin-top: 35px;
      text-align: left;
    }

    .instructions h3 {
      color: #1976D2;
      margin-bottom: 15px;
      font-size: 18px;
    }

    .instructions ol {
      margin-left: 20px;
      color: #333;
    }

    .instructions li {
      margin: 10px 0;
      line-height: 1.7;
      font-size: 15px;
    }

    .instructions strong {
      color: #1976D2;
    }

    .error {
      background: #f8d7da;
      border: 2px solid #f5c6cb;
      color: #721c24;
      padding: 25px;
      border-radius: 12px;
      margin-top: 20px;
    }

    .error h3 {
      margin-bottom: 10px;
    }

    .preview {
      margin-top: 20px;
      max-width: 100%;
      max-height: 250px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .success-msg {
      color: #155724;
      background: #d4edda;
      border: 2px solid #c3e6cb;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    code {
      background: #f4f4f4;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
    }

    .tip {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin-top: 20px;
      border-radius: 4px;
      text-align: left;
      font-size: 14px;
      color: #856404;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéØ AI Answer Finder</h1>
    <p class="subtitle">
      –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Ç–µ—Å—Ç–∞—Ö<br>
      –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª—é–±–æ–º Chromebook –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
    </p>

    <button id="startBtn">üöÄ –ù–∞–π—Ç–∏ –æ—Ç–≤–µ—Ç</button>

    <div id="result"></div>

    <div class="instructions">
      <h3>üìñ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</h3>
      <ol>
        <li><strong>–û—Ç–∫—Ä–æ–π —Ç–µ—Å—Ç</strong> –≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ (–æ—Å—Ç–∞–≤—å –µ—ë –æ—Ç–∫—Ä—ã—Ç–æ–π)</li>
        <li><strong>–í–µ—Ä–Ω–∏—Å—å –Ω–∞ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É</strong> –∏ –Ω–∞–∂–º–∏ "–ù–∞–π—Ç–∏ –æ—Ç–≤–µ—Ç"</li>
        <li><strong>–í –æ–∫–Ω–µ –≤—ã–±–æ—Ä–∞</strong> –Ω–∞–∂–º–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "Chrome Tab" –∏–ª–∏ "–í–∫–ª–∞–¥–∫–∞"</li>
        <li><strong>–í—ã–±–µ—Ä–∏ –≤–∫–ª–∞–¥–∫—É —Å —Ç–µ—Å—Ç–æ–º</strong> (–∫–ª–∏–∫–Ω–∏ –Ω–∞ –Ω–µ—ë –≤ —Å–ø–∏—Å–∫–µ)</li>
        <li><strong>–ù–∞–∂–º–∏ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"</strong> –≤–Ω–∏–∑—É</li>
        <li><strong>–ü–æ–¥–æ–∂–¥–∏ 3-5 —Å–µ–∫—É–Ω–¥</strong> - AI –ø–æ–∫–∞–∂–µ—Ç –±—É–∫–≤—É –æ—Ç–≤–µ—Ç–∞!</li>
      </ol>
    </div>

    <div class="tip">
      üí° <strong>–°–æ–≤–µ—Ç:</strong> –î–æ–±–∞–≤—å —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –∑–∞–∫–ª–∞–¥–∫–∏ (<code>Ctrl+D</code>) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞!
    </div>
  </div>

  <script>
    const API_KEY = 'AIzaSyDmJEzLEv3Qo50iFoYJ5jWCda49m3jCK5I';
    const btn = document.getElementById('startBtn');
    const resultDiv = document.getElementById('result');

    btn.addEventListener('click', async () => {
      btn.disabled = true;
      btn.textContent = '‚è≥ –ì–æ—Ç–æ–≤–ª—é—Å—å...';
      resultDiv.style.display = 'none';

      try {
        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º screen sharing (–≤—ã–±–æ—Ä –≤–∫–ª–∞–¥–∫–∏)
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = `
          <p style="font-size:18px;color:#333">
            üì∫ –°–µ–π—á–∞—Å –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞<br><br>
            <strong style="color:#667eea">–í—ã–±–µ—Ä–∏ –≤–∫–ª–∞–¥–∫—É —Å —Ç–µ—Å—Ç–æ–º!</strong><br>
            <small style="color:#666">(–Ω–µ –≤–µ—Å—å —ç–∫—Ä–∞–Ω, –∞ –∏–º–µ–Ω–Ω–æ –≤–∫–ª–∞–¥–∫—É Chrome)</small>
          </p>
        `;

        const stream = await navigator.mediaDevices.getDisplayMedia({
          video: {
            displaySurface: 'browser',
            width: { ideal: 1920 },
            height: { ideal: 1080 }
          },
          audio: false,
          preferCurrentTab: false
        });

        btn.textContent = 'üì∏ –ó–∞—Ö–≤–∞—Ç—ã–≤–∞—é...';
        resultDiv.innerHTML = '<div class="loading"></div><p style="color:#333;font-size:16px">–î–µ–ª–∞—é —Å–∫—Ä–∏–Ω—à–æ—Ç –≤–∫–ª–∞–¥–∫–∏...</p>';

        // –ñ–¥–µ–º —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ –≤–∏–¥–µ–æ
        await new Promise(resolve => setTimeout(resolve, 1500));

        // –°–æ–∑–¥–∞–µ–º –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç
        const video = document.createElement('video');
        video.srcObject = stream;
        video.autoplay = true;
        video.playsInline = true;

        await new Promise((resolve) => {
          video.onloadedmetadata = () => {
            video.play();
            resolve();
          };
        });

        await new Promise(resolve => setTimeout(resolve, 800));

        // –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0);

        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞—Ö–≤–∞—Ç
        stream.getTracks().forEach(track => track.stop());

        const screenshot = canvas.toDataURL('image/jpeg', 0.8);
        const screenshotBase64 = screenshot.split(',')[1];
        
        resultDiv.innerHTML = `
          <div class="loading"></div>
          <p style="color:#333;font-size:18px;margin-bottom:15px">ü§ñ AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–æ–ø—Ä–æ—Å...</p>
          <img src="${screenshot}" class="preview">
        `;

        btn.textContent = 'üß† AI –¥—É–º–∞–µ—Ç...';

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Gemini AI
        const response = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${API_KEY}`,
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contents: [{
                parts: [
                  {
                    text: `–≠—Ç–æ —Å–∫—Ä–∏–Ω—à–æ—Ç —Ç–µ—Å—Ç–∞/—ç–∫–∑–∞–º–µ–Ω–∞ —Å –≤–æ–ø—Ä–æ—Å–æ–º –∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤.

–ó–ê–î–ê–ß–ê: –ù–∞–π–¥–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∏ –≤–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –û–î–ù–£ –ë–£–ö–í–£ (A, B, C, D, E –∏–ª–∏ –ê, –ë, –í, –ì, –î).

–ü–†–ê–í–ò–õ–ê:
- –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –±—É–∫–≤—É, –±–µ–∑ —Ç–æ—á–µ–∫, —Å–∫–æ–±–æ–∫, –æ–±—ä—è—Å–Ω–µ–Ω–∏–π
- –ï—Å–ª–∏ –≤–∏–¥–∏—à—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤ - –æ—Ç–≤–µ—á–∞–π –Ω–∞ –ø–µ—Ä–≤—ã–π/—Å–∞–º—ã–π –∑–∞–º–µ—Ç–Ω—ã–π
- –ï—Å–ª–∏ —ç—Ç–æ True/False –≤–æ–ø—Ä–æ—Å - –≤–µ—Ä–Ω–∏ T –∏–ª–∏ F
- –ï—Å–ª–∏ –Ω–µ —É–≤–µ—Ä–µ–Ω - –≤—Å—ë —Ä–∞–≤–Ω–æ –≤—ã–±–µ—Ä–∏ –Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç

–ü–†–ò–ú–ï–†–´ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:
A
B
C

–ü–†–ò–ú–ï–†–´ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:
A) –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
–û—Ç–≤–µ—Ç: B
–í–∞—Ä–∏–∞–Ω—Ç C —è–≤–ª—è–µ—Ç—Å—è –≤–µ—Ä–Ω—ã–º

–¢–≤–æ–π –æ—Ç–≤–µ—Ç (—Ç–æ–ª—å–∫–æ –±—É–∫–≤–∞):`
                  },
                  {
                    inline_data: {
                      mime_type: 'image/jpeg',
                      data: screenshotBase64
                    }
                  }
                ]
              }],
              generationConfig: {
                temperature: 0.2,
                maxOutputTokens: 5,
                topP: 0.8,
                topK: 10
              }
            })
          }
        );

        if (!response.ok) {
          throw new Error(`API error: ${response.status}`);
        }

        const data = await response.json();
        console.log('Gemini response:', data);

        if (!data.candidates || !data.candidates[0]) {
          throw new Error('AI –Ω–µ –≤–µ—Ä–Ω—É–ª –æ—Ç–≤–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.');
        }

        const aiText = data.candidates[0].content.parts[0].text.trim();
        console.log('AI raw text:', aiText);

        // –ò–∑–≤–ª–µ–∫–∞–µ–º –±—É–∫–≤—É (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±)
        let answer = '?';
        
        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –æ–¥–∏–Ω–æ—á–Ω—É—é –±—É–∫–≤—É
        const singleLetter = aiText.match(/^([A-E–ê–ë–í–ì–î])\s*$/i);
        if (singleLetter) {
          answer = singleLetter[1].toUpperCase();
        } else {
          // –ï—Å–ª–∏ –Ω–µ—Ç - –∏—â–µ–º –ª—é–±—É—é –±—É–∫–≤—É –∏–∑ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö
          const anyLetter = aiText.match(/[A-E–ê–ë–í–ì–î]/i);
          if (anyLetter) {
            answer = anyLetter[0].toUpperCase();
          }
        }

        if (answer === '?') {
          resultDiv.innerHTML = `
            <div class="error">
              <h3>‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ—Ç–≤–µ—Ç</h3>
              <p><strong>AI –æ—Ç–≤–µ—Ç–∏–ª:</strong> "${aiText}"</p>
              <p style="margin-top:15px">
                <strong>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:</strong><br>
                ‚Ä¢ –í–æ–ø—Ä–æ—Å –Ω–µ –≤–∏–¥–µ–Ω –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ<br>
                ‚Ä¢ –ù–µ–æ–±—ã—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ—Å—Ç–∞<br>
                ‚Ä¢ –ü–ª–æ—Ö–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
              </p>
              <p style="margin-top:15px">
                <small>üí° –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑ –∏ —É–±–µ–¥–∏—Å—å, —á—Ç–æ –≤–æ–ø—Ä–æ—Å —Ö–æ—Ä–æ—à–æ –≤–∏–¥–µ–Ω</small>
              </p>
            </div>
          `;
        } else {
          resultDiv.innerHTML = `
            <h2 style="color:#667eea;margin-bottom:10px;font-size:24px">‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</h2>
            <div class="answer">${answer}</div>
            <div class="success-msg">
              üéØ AI —É–≤–µ—Ä–µ–Ω–Ω–æ –≤—ã–±—Ä–∞–ª —ç—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç!
            </div>
            <p style="color:#666;margin-top:20px;font-size:14px">
              <em>–°–∫—Ä–∏–Ω—à–æ—Ç –±—ã–ª —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω</em>
            </p>
          `;
        }

        btn.textContent = 'üîÑ –ù–∞–π—Ç–∏ –µ—â–µ –æ—Ç–≤–µ—Ç';
        btn.disabled = false;

      } catch (error) {
        console.error('Error:', error);
        
        let errorMessage = error.message;
        let helpText = '';

        if (error.name === 'NotAllowedError' || errorMessage.includes('denied')) {
          errorMessage = '–î–æ—Å—Ç—É–ø –∫ —ç–∫—Ä–∞–Ω—É –∑–∞–ø—Ä–µ—â–µ–Ω';
          helpText = '–ù—É–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –≤–∫–ª–∞–¥–∫–µ –≤ –ø–æ—è–≤–∏–≤—à–µ–º—Å—è –æ–∫–Ω–µ';
        } else if (errorMessage.includes('API')) {
          errorMessage = '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ AI';
          helpText = '–ü—Ä–æ–≤–µ—Ä—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ';
        }
        
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = `
          <div class="error">
            <h3>‚ùå –û—à–∏–±–∫–∞</h3>
            <p style="font-size:18px;margin:10px 0"><strong>${errorMessage}</strong></p>
            ${helpText ? `<p style="margin-top:10px">${helpText}</p>` : ''}
            <p style="margin-top:15px;font-size:13px;opacity:0.8">
              <code>${error.toString()}</code>
            </p>
          </div>
        `;

        btn.textContent = 'üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞';
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
